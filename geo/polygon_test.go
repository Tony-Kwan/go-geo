package geo

import (
	"fmt"
	"github.com/atotto/clipboard"
	"strings"
	"testing"
)

func TestPolygon_Triangulate(t *testing.T) {
	polygon := Polygon{shell: LinearRing{
		//*NewPoint(-114.48303222656251, 38.39468429873875, nil),
		//*NewPoint(-97.49473571777345, 28.884362064951418, nil),
		//*NewPoint(-86.58977508544923, 36.15700384567333, nil),
		//*NewPoint(-76.65985107421875, 31.486650038733302, nil),
		//*NewPoint(-66.9386672973633, 41.65239288426815, nil),
		//*NewPoint(-78.3706283569336, 40.22109212030119, nil),
		//*NewPoint(-90.11192321777345, 48.20911695037711, nil),
		//*NewPoint(-90.74810028076169, 34.93013417230951, nil),
		//*NewPoint(-103.67694854736328, 39.471185234712465, nil),
		//*NewPoint(-105.26824951171875, 47.96693928840199, nil),
		//*NewPoint(-114.48303222656251, 38.39468429873875, nil),

		//*NewPoint(-126.04545593261719, 43.99404946578386, nil),
		//*NewPoint(-126.13334655761719, 31.03969759558136, nil),
		//*NewPoint(-110.92826843261719, 27.279958882565637, nil),
		//*NewPoint(-96.95365905761717, 31.715025580423827, nil),
		//*NewPoint(-90.88920593261717, 42.34712656235513, nil),
		//*NewPoint(-89.8956298828125, 47.01654600163033, nil),
		//*NewPoint(-100.32783508300781, 48.53411250954363, nil),
		//*NewPoint(-109.2047882080078, 49.055195215685586, nil),
		//*NewPoint(-119.61021423339844, 47.77186813430575, nil),
		//*NewPoint(-126.04545593261719, 43.99404946578386, nil),

		//*NewPoint(-113.70197296142578, 44.86438632934659, nil),
		//*NewPoint(-130.13751983642578, 29.455143906645745, nil),
		//*NewPoint(-75.5574417114258, 34.59365010878254, nil),
		//*NewPoint(-114.75666046142578, 36.1700311594995, nil),
		//*NewPoint(-91.90509796142578, 40.777421721005965, nil),
		//*NewPoint(-112.47528076171875, 40.242846824049764, nil),
		//*NewPoint(-99.29168701171876, 45.086126831109596, nil),
		//*NewPoint(-113.35418701171875, 42.48526384858917, nil),
		//*NewPoint(-107.81330108642578, 47.21676985912018, nil),
		//*NewPoint(-113.70197296142578, 44.86438632934659, nil),

		//*NewPoint(-92.38059997558592, 45.38157243512828, nil),
		//*NewPoint(-90.47378540039062, 40.582670638095294, nil),
		//*NewPoint(-81.50894165039061, 39.77397788285171, nil),
		//*NewPoint(-87.19505310058592, 37.1594957106433, nil),
		//*NewPoint(-86.93138122558594, 32.01972036197235, nil),
		//*NewPoint(-91.06224060058594, 35.909908145897035, nil),
		//*NewPoint(-95.95733642578125, 31.974007590177635, nil),
		//*NewPoint(-94.81475830078125, 37.60580020781012, nil),
		//*NewPoint(-102.54913330078125, 38.29882852868994, nil),
		//*NewPoint(-93.93585205078125, 40.27140563877154, nil),
		//*NewPoint(-92.38059997558592, 45.38157243512828, nil),

		//*NewPoint(74.2578125, 39.621429561469405, nil),
		//*NewPoint(79.8828125, 29.51477118439974, nil),
		//*NewPoint(89.0234375, 27.038185890606425, nil),
		//*NewPoint(96.0546875, 27.818283695265492, nil),
		//*NewPoint(97.63671875, 23.21974072449734, nil),
		//*NewPoint(102.734375, 20.610779163835605, nil),
		//*NewPoint(106.42578125, 22.08421389791909, nil),
		//*NewPoint(109.58984375, 20.77522020258329, nil),
		//*NewPoint(107.83203125, 18.62396621466031, nil),
		//*NewPoint(110.8203125, 17.95636814874924, nil),
		//*NewPoint(112.578125, 20.11639459962949, nil),
		//*NewPoint(113.984375, 21.75807045655614, nil),
		//*NewPoint(118.203125, 23.381185742097884, nil),
		//*NewPoint(122.24609375, 28.747047331288254, nil),
		//*NewPoint(119.9609375, 34.86664231347982, nil),
		//*NewPoint(122.94921875, 37.0013236690325, nil),
		//*NewPoint(119.08203125, 38.66715454190508, nil),
		//*NewPoint(121.89453125, 40.29511275849318, nil),
		//*NewPoint(124.1796875, 38.941124031224966, nil),
		//*NewPoint(132.79296875, 43.4358484985812, nil),
		//*NewPoint(135.4296875, 48.44275745201333, nil),
		//*NewPoint(124.70703125, 53.42171048308583, nil),
		//*NewPoint(119.43359375, 52.89472027140551, nil),
		//*NewPoint(116.09375, 48.09172926581341, nil),
		//*NewPoint(119.2578125, 47.14385078544284, nil),
		//*NewPoint(110.8203125, 44.44836894092476, nil),
		//*NewPoint(107.48046875, 42.53575805798032, nil),
		//*NewPoint(96.7578125, 43.05170938232444, nil),
		//*NewPoint(87.44140625, 49.13758971827566, nil),
		//*NewPoint(74.2578125, 39.621429561469405, nil),

		*NewPoint(-1.6991043090820295, 43.32317958748908, nil),
		*NewPoint(3.936882019042976, 42.161367532874806, nil),
		*NewPoint(3.581542968750002, 43.11953018614551, nil),
		*NewPoint(6.507682800292972, 42.94360648947236, nil),
		*NewPoint(7.775917053222664, 43.726700289570346, nil),
		*NewPoint(7.122917175292971, 44.847836846819575, nil),
		*NewPoint(6.737022399902351, 46.3104186157758, nil),
		*NewPoint(7.2142410278320375, 47.52856107277904, nil),
		*NewPoint(8.028602600097656, 49.073640995014955, nil),
		*NewPoint(2.7785110473632812, 51.27093716704937, nil),
		*NewPoint(1.4405822753906263, 50.82654161609699, nil),
		*NewPoint(1.5284729003906241, 49.996484644867365, nil),
		*NewPoint(-1.6918945312499958, 49.65629401936761, nil),
		*NewPoint(-1.718673706054683, 48.69005384564221, nil),
		*NewPoint(-5.080490112304683, 48.803471664383096, nil),
		*NewPoint(-4.904708862304683, 47.97912122349871, nil),
		*NewPoint(-2.723236083984373, 47.16450869129574, nil),
		*NewPoint(-1.6956710815429656, 46.10775536585561, nil),
		*NewPoint(-1.722450256347653, 44.31844432059691, nil),
		*NewPoint(-1.6991043090820295, 43.32317958748908, nil),
	}}
	fmt.Println(&polygon)
	tris, err := polygon.Triangulate()
	if err != nil {
		t.Error(err)
		return
	}
	wkts := make([]string, len(tris))
	for i, tri := range tris {
		wkts[i] = tri.String()
	}
	wkt := fmt.Sprintf("GEOMETRYCOLLECTION(%s)", strings.Join(wkts, ", "))
	//t.Log(wkt)
	clipboard.WriteAll(wkt)
}

func TestPolygon_ConvexHull(t *testing.T) {
	polygon := Polygon{shell: LinearRing{
		*NewPoint(-114.48303222656251, 38.39468429873875, nil),
		*NewPoint(-97.49473571777345, 28.884362064951418, nil),
		*NewPoint(-86.58977508544923, 36.15700384567333, nil),
		*NewPoint(-76.65985107421875, 31.486650038733302, nil),
		*NewPoint(-66.9386672973633, 41.65239288426815, nil),
		*NewPoint(-78.3706283569336, 40.22109212030119, nil),
		*NewPoint(-90.11192321777345, 48.20911695037711, nil),
		*NewPoint(-90.74810028076169, 34.93013417230951, nil),
		*NewPoint(-103.67694854736328, 39.471185234712465, nil),
		*NewPoint(-105.26824951171875, 47.96693928840199, nil),
		*NewPoint(-114.48303222656251, 38.39468429873875, nil),
	}}
	t.Log(polygon.String())
	hull, _ := polygon.ConvexHull()
	t.Log(hull.String())

	wkt := fmt.Sprintf("GEOMETRYCOLLECTION(%s,%s)", polygon.String(), hull.String())
	t.Log(wkt)
}
